

```{python}
#| label: setup
import sys
sys.path.insert(0, ".")
from _common import *
import plotly.graph_objects as go
from plotly.subplots import make_subplots
```

# Distributional Analysis {#sec-distributional}

::: {.chapter-opening}
Who gains, and who risks being left behind? Aggregate NPV and BCR confirm that society gains overall, but they are silent on distribution. This chapter uses 4,817 household records from **HIES 2019** to trace impacts by income quintile, gender, and geography.
:::

## Data Source

```{python}
#| label: dist-baseline
baseline = distributional.get("baseline", {})
data_source = distributional.get("data_source", "HIES 2019")
n_households = baseline.get("n_households", 4817)
```

The analysis uses `{python} f"{n_households:,}"` households from `{python} data_source` [@hies2019], with data on income, electricity spending, household composition, location, and head-of-household gender. These variables establish the baseline distributional profile against which transition impacts are assessed.

## Electricity Burden by Income Quintile

Electricity burden — expenditure as a share of income — is regressive worldwide: lower-income households spend a larger share on energy despite lower absolute consumption.

```{python}
#| label: fig-quintile-burden
#| fig-cap: "Electricity expenditure as a share of total household income, by income quintile. Lower-income households bear a disproportionately higher energy burden."

by_quintile = distributional.get("by_quintile", [])

if by_quintile:
    # by_quintile is a list of dicts with 'quintile' and 'mean_elec_share_pct'
    quintile_data = sorted(by_quintile, key=lambda x: x.get("quintile", 0))
    burdens = [q.get("mean_elec_share_pct", 0) for q in quintile_data]
    
    fig = go.Figure(go.Bar(
        x=[f"Q{q.get('quintile', i+1)}" + (" (Poorest)" if i == 0 else " (Richest)" if i == len(quintile_data)-1 else "") 
           for i, q in enumerate(quintile_data)],
        y=burdens,
        marker_color=["#e74c3c", "#f39c12", "#f1c40f", "#2ecc71", "#27ae60"][:len(burdens)],
        text=[f"{b:.1f}%" for b in burdens],
        textposition="outside",
    ))
    fig.update_layout(
        title="Electricity Expenditure as Share of Income, by Quintile",
        yaxis_title="Energy Burden (%)",
        height=420,
        showlegend=False,
    )
    fig.show()
```

@fig-quintile-burden shows the expected regressive pattern: Q1 households devote the largest share of income to electricity despite lower absolute consumption.

If transition delivers lower costs, low-income households gain proportionally most; if it requires temporary tariff increases, the burden falls hardest on them. Tariff design must account for this.

::: {.callout-important}
The poorest 20% of households devote a far larger share of income to electricity than the richest 20%. Any transition policy that raises tariffs, even temporarily during the investment phase, will hit low-income households hardest unless accompanied by lifeline tariff blocks and targeted cash transfers.
:::

## Gender Analysis

Female-headed households in SIDS often have lower incomes and primary responsibility for energy decisions. HIES 2019 allows disaggregation by headship gender.

```{python}
#| label: fig-gender
#| fig-cap: "Energy burden comparison between male-headed and female-headed households."

by_gender = distributional.get("by_gender", [])
gender_poverty = distributional.get("gender_energy_poverty", {})

if by_gender:
    # by_gender is a list of dicts with 'gender', 'n_households', 'mean_elec_share_pct'
    fig = make_subplots(rows=1, cols=2, subplot_titles=["Energy Burden (%)", "Energy Poverty Rate (%)"])
    
    for gdata in by_gender:
        gender_label = gdata.get("gender", "").replace("_", " ").title()
        burden = gdata.get("mean_elec_share_pct", 0)
        poverty = gdata.get("energy_poverty_pct", 0)
        n = gdata.get("n_households", 0)
        
        color = "#3498db" if "male" in gender_label.lower() and "female" not in gender_label.lower() else "#e74c3c"
        label = f"{gender_label} (n={n:,})"
        
        fig.add_trace(go.Bar(
            x=[label], y=[burden],
            marker_color=color, showlegend=False,
            text=[f"{burden:.1f}%"], textposition="outside",
        ), row=1, col=1)
        
        fig.add_trace(go.Bar(
            x=[label], y=[poverty],
            marker_color=color, showlegend=False,
            text=[f"{poverty:.1f}%"], textposition="outside",
        ), row=1, col=2)
    
    fig.update_layout(height=400, title_text="Gender Disaggregated Energy Analysis")
    fig.show()
```

@fig-gender compares burden and energy poverty rates. Differences may reflect income, household size, and dwelling characteristics. The 10% threshold follows Boardman (1991) and Hills (2012)^[See [Appendix B](B-parameters.qmd).].

## Geographic Distribution

Greater Malé benefits from economies of scale and a diversified economic base; outer atoll communities rely on small isolated generators with higher per-unit costs and more limited incomes.

```{python}
#| label: fig-geography-dist
#| fig-cap: "Electricity burden and expenditure patterns across Malé, urban outer, and rural outer island households."

by_geography = distributional.get("by_geography", {})

if by_geography:
    geo_cats = list(by_geography.keys())
    burdens = [by_geography[g].get("mean_elec_share_pct", 0) for g in geo_cats]
    
    geo_labels = {"male": "Malé", "atoll": "Outer Atolls"}
    
    fig = go.Figure(go.Bar(
        x=[geo_labels.get(g, g.replace("_", " ").title()) for g in geo_cats],
        y=burdens,
        marker_color=["#3498db", "#2ecc71", "#f39c12"][:len(geo_cats)],
        text=[f"{b:.1f}%" for b in burdens],
        textposition="outside",
    ))
    fig.update_layout(
        title="Energy Burden by Geography",
        yaxis_title="Energy Burden (%)",
        height=400,
        showlegend=False,
    )
    fig.show()
```

@fig-geography-dist illustrates the geographic burden. Outer atoll households face both higher costs and lower incomes. Centralised scenarios (S2) primarily benefit Malé; distributed renewables (S4) directly target the highest-cost islands. The pathway choice affects not just aggregate efficiency but spatial equity.

## Scenario-Specific Tariff Impacts

Distributional consequences depend on tariff trajectories. Capital-intensive pathways may require temporary increases; rapid diesel displacement may deliver reductions even during investment.

```{python}
#| label: fig-tariff-impact
#| fig-cap: "Projected impact of each scenario on household electricity tariffs and monthly bills."

tariff_impacts = distributional.get("scenario_tariff_impacts", {})

if tariff_impacts:
    scenarios_with_tariff = [s for s in ALT_SCENARIOS if s in tariff_impacts]
    
    if scenarios_with_tariff:
        fig = go.Figure()
        for sid in scenarios_with_tariff:
            td = tariff_impacts[sid]
            if isinstance(td, list):
                # Average change_pct across quintiles/geographies
                pcts = [row.get("change_pct", 0) for row in td if isinstance(row, dict)]
                change = sum(pcts) / len(pcts) if pcts else 0
            elif isinstance(td, dict):
                change = td.get("tariff_change_pct", td.get("change_pct", 0))
            else:
                change = 0
            # change_pct is already in percentage points (e.g. -52 = -52%)
            fig.add_trace(go.Bar(
                x=[SCENARIO_SHORT[sid]],
                y=[change],
                marker_color=SCENARIO_COLORS[sid],
                showlegend=False,
                text=[f"{change:+.0f}%"],
                textposition="outside",
            ))
        
        fig.add_hline(y=0, line_dash="dash", line_color="gray")
        fig.update_layout(
            title="Projected Tariff Change by Scenario (%)",
            yaxis_title="Tariff Change (%)",
            height=400,
        )
        fig.show()
```

@fig-tariff-impact shows projected percentage changes. Negative = tariff reduction (households pay less than under diesel). High-RE scenarios deliver reductions because fuel savings exceed amortised capital.

## Energy Poverty Assessment

```{python}
#| label: energy-poverty
energy_poverty = distributional.get("energy_poverty", {})

if energy_poverty:
    poverty_rate = energy_poverty.get("poverty_rate", energy_poverty.get("rate", 0))
    threshold = energy_poverty.get("threshold", 0.10)
```

Energy poverty (`{python} f"{threshold*100:.0f}" if energy_poverty else "10"`% threshold per Boardman 1991): rate is `{python} f"{poverty_rate*100:.1f}" if energy_poverty and isinstance(poverty_rate, (int, float)) else "[see outputs]"`%. Poverty clusters among low-income quintiles, female-headed households, and outer atolls.

## Progressivity: The Suits Index

```{python}
#| label: progressivity
prog = distributional.get("progressivity", {})
```

The **Suits Index** — analogous to Gini for tariff burdens — ranges from −1 (regressive) through 0 (proportional) to +1 (progressive). Current index: `{python} f"{prog.get('suits_index', 0):.3f}" if prog else "[see outputs]"` — confirming regressivity. Tariff reforms that move the index toward zero improve distributional equity.

## Policy Implications for Equitable Transition

The status quo is regressive, and a poorly designed transition would deepen rather than correct this.

::: {.policy-rec}
#### Equitable Transition Design
:::

**Lifeline tariff blocks:** First ~100 kWh priced at or below current rates; higher blocks recover capital. Low-income households, who consume less, are effectively shielded.

**Targeted transfers:** Cash payments to identified low-income households during investment phase preserve price signals while protecting welfare. HIES microdata enable efficient targeting.

**Cross-subsidisation:** Tourism/commercial tariffs set above cost; residential below. The high-revenue resort sector can finance equitable transition.

**Connection cost subsidies:** ~`{python} f"${param('Cost per Household', category='Connection'):.0f}"`/HH for ~`{python} f"{param('Number of Households', category='Connection')/1000:.0f}"`k households. Government/donor financing prevents a two-tier system where poorer households remain on expensive diesel.
